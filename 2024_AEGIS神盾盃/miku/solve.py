import threading
from Crypto.Util.number import long_to_bytes

miku = 2952909037608119121575883598697771668082052760586318278114601190677491359310250096052040312413755395039956515626035958896605846648054199583204537213943752196665865833943690595794484460540058094826052041258525369112119213570478608387370976518529169863627623953687688390836338074951673418720282621867365126104667369813894624764341015682815417083680391637831629639023988832503298830289608824141150626455639080375307987439867535293172467417570387250848007719  # Replace with actual miku value from hint.txt
negi = 0x10001 
kotoba_hint = 1251927737870225679331057051890022134458749815402079014422418885114109373962236718723590427943281582625838598633842658777615353914656795883675925674822129598615722923268683489737498191576121021326859696003808735149937822079944470110941833006937269871224461232052717239695763645607382498627697292632410027454529950096098034615675073777966740079796629520463829317210031167380210192537533176245717027995925874538000277996372995315845242838369933102967264829  # Replace with actual kotoba value from hint.txt (encrypted form)
print(hex(kotoba_hint))
kotoba_factors = [276228829519,287059084673,296419253981,299226234379,300751505207,303630994577,315688377073,327558967097,331013571869,357725216353,362725429477,370236569581,387671762011,411810362771,419362349207,423484160027,427458048239,440026736561,440755673803,440781277399,456240490439,457684593253,475720954117,492683642527,502195386353,502575161227,506007103321,506414441941,511088739803,511616425183,513345822919,517861162349,522907934027,523093661287,534379713871,534849004177,536851476493,539050373621,542146765313]
res = 1
for a in kotoba_factors:
    res *= (a-1)

priv = pow(negi, -1, res)

rsakey = long_to_bytes(pow(kotoba_hint, priv, miku))
import binascii
with open('flag.png.enc', 'rb') as f:
    iv = f.readline().strip()
    iv = binascii.unhexlify(iv)
    print(iv)
    enc = f.readline().strip()
    enc = binascii.unhexlify(enc)
    from Crypto.Cipher import AES
    from Crypto.Util.Padding import unpad
    cipher = AES.new(rsakey, AES.MODE_CBC, iv=iv)
    with open('flag.png', 'wb') as g:
        g.write(unpad(cipher.decrypt(enc), AES.block_size))

